<?php

namespace Database\Seeders;

use App\Models\User;
use App\Models\VulnerabilityScore;
use Illuminate\Database\Seeder;

class VulnerabilityScoreSeeder extends Seeder
{
    /**
     * Seed vulnerability scores for recipient/requestor users.
     */
    public function run(): void
    {
        $admin = User::where('role', 'admin')->first();
        $assessedBy = $admin?->id;

        $recipients = User::whereIn('role', ['requestor', 'recipient'])->get();
        if ($recipients->isEmpty()) {
            return;
        }

        // Varied scores: Critical (85), High (65), Medium (45), Low (25)
        $scores = [
            ['economic' => 90, 'social' => 85, 'health' => 80, 'geographic' => 85],
            ['economic' => 70, 'social' => 65, 'health' => 60, 'geographic' => 65],
            ['economic' => 50, 'social' => 45, 'health' => 40, 'geographic' => 45],
        ];

        foreach ($recipients as $index => $user) {
            $s = $scores[$index % count($scores)];
            $overall = ($s['economic'] * 0.30) + ($s['social'] * 0.25) + ($s['health'] * 0.25) + ($s['geographic'] * 0.20);

            VulnerabilityScore::updateOrCreate(
                ['user_id' => $user->id],
                [
                    'economic_score' => $s['economic'],
                    'social_score' => $s['social'],
                    'health_score' => $s['health'],
                    'geographic_score' => $s['geographic'],
                    'overall_score' => round($overall, 2),
                    'assessment_date' => now(),
                    'assessed_by' => $assessedBy,
                    'notes' => 'Initial assessment for resource allocation',
                ]
            );
        }
    }
}
